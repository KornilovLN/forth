# Освобождение памяти в Forth

#### В Forth управление памятью отличается от C/C++ или языков с GC.

## Способы, как можно "освободить" память:

### 1. Для стандартных переменных (VARIABLE) и массивов (CREATE ... ALLOT)
* **В стандартном Forth нет прямого способа освободить память, выделенную при помощи VARIABLE или CREATE ... ALLOT.**
* **Эта память остаётся в словаре до завершения программы.**
* **Однако есть несколько вариантов:**
  * Многие Forth-системы, включая Gforth, поддерживают слово **MARKER**, которое позволяет "отмотать" словарь до определённой точки:
```
MARKER CLEANUP  \ Устанавливаем маркер

\ Далее идёт код с объявлением переменных и массивов
VARIABLE TEMP
CREATE MY-ARRAY 100 CELLS ALLOT

\ Когда работа завершена:
CLEANUP         \ Удаляет всё, что было определено после маркера
```
  * Для более гибкого управления памятью - **динамическое выделение**:
```
\ Выделение памяти
0 0 100 CELLS ALLOCATE THROW CONSTANT MY-ARRAY

\ Использование...

\ Освобождение памяти
MY-ARRAY FREE THROW
```

### 2. Локальные переменные
* **Для временных переменных - локальные:**
```
: MY-WORD { | temp array[100] -- }
    \ temp и array[100] существуют только во время выполнения MY-WORD
    \ После завершения MY-WORD память автоматически освобождается
;
```

### 3. Повторное использование с ERASE
* **Если нужно просто очистить данные, но не освобождать память:**
```
VARIABLE DATA
CREATE MY-ARRAY 100 CELLS ALLOT

\ После использования:
DATA 0!                     \ Обнуляем переменную
MY-ARRAY 100 CELLS ERASE    \ Заполняем массив нулями
```

### 4.Практические рекомендации
* Для небольших программ: не беспокойтесь об освобождении памяти - это не критично
* Для модульных программ: используйте MARKER для очистки временных определений
* Для масштабных приложений: планируйте структуру памяти заранее, используйте ALLOCATE/FREE
* Для временных данных: предпочитайте локальные переменные или работу через стек

#### В Forth философия управления памятью отличается от других языков - вы, как программист, берёте на себя больше ответственности, но получаете и больше контроля.

